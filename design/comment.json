{"_id": "_design/comment", "language": "javascript", "views": {"by_user": {"map": "function(doc) {\n  if(doc.type==\"article\"){\n    for(i in doc.comments){\n      var cmt = doc.comments[i];\n      emit([doc.userid, \"recv\", cmt.date], {_id:cmt.userid, comment:cmt});\n      emit([cmt.userid, \"send\", cmt.date], {_id:cmt.userid, comment:cmt});\n    }\n  }\n}", "reduce": "function(keys,values,rereduce){\n  if (rereduce){\n    return sum(values);\n  }else{\n    return values.length;\n  }\n}"}, "by_article": {"map": "function(doc) {\n  if(doc.type==\"article\"){\n    for(i in doc.comments){\n      var cmt = doc.comments[i];\n      emit([doc._id, cmt.date], {_id:cmt.userid, comment:cmt});\n    }\n  }\n}", "reduce": "function(keys,values,rereduce){\n  if (rereduce){\n    return sum(values);\n  }else{\n    return values.length;\n  }\n}"}}}